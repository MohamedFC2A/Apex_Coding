# خطة إصلاح مشكلة "Initializing Preview\..." وتسريع المعاينة

المشكلة تكمن في أن واجهة المعاينة (Preview) تظل عالقة في حالة "Initializing Preview\..." إما بسبب بطء الاتصال بخدمة CodeSandbox أو عدم وجود رد من الخادم عند حدوث خطأ، أو غياب مفتاح API.

لحل هذه المشكلة وجعل المعاينة "سريعة وطبيعية"، سأقوم بتنفيذ الخطوات التالية:

## 1. تحسين واجهة المعاينة (Frontend Optimization)

سأقوم بتعديل الملف `frontend/src/components/Preview/PreviewRunnerPreview.tsx` لإضافة:

* **مهلة زمنية (Timeout):** تحديد مهلة (مثلاً 15 ثانية) لطلب إنشاء الجلسة. إذا تأخر الخادم، سيتم إيقاف الانتظار وعرض رسالة واضحة بدلاً من التعليق.

* **عرض الأخطاء:** تحسين طريقة عرض رسائل الخطأ للمستخدم (مثل "Missing CSB\_API\_KEY") بدلاً من البقاء في شاشة التحميل.

* **زر إعادة المحاولة (Retry):** إضافة زر يسمح للمستخدم بإعادة المحاولة يدوياً في حال الفشل.

## 2. التحقق من إعدادات البيئة (Environment Check)

* سأتحقق من وجود ملف `.env` في المشروع.

* إذا كان غير موجود، سأقوم بإنشائه من `.env.example` للتأكد من أن المتغيرات الأساسية موجودة (حتى لو كانت فارغة)، مما يمنع الخادم من التعليق بسبب أخطاء التكوين.

## 3. تحسين استجابة الخادم (Backend Optimization)

* سأقوم بمراجعة `api/utils/codesandbox.js` للتأكد من أن عملية إنشاء الـ Sandbox لا تستغرق وقتاً أطول من اللازم، وإضافة معالجة أفضل للأخطاء لضمان إرجاع رد سريع للواجهة الأمامية في حال الفشل.

### الملفات التي سيتم تعديلها:

1. `frontend/src/components/Preview/PreviewRunnerPreview.tsx` (إضافة Timeout ومعالجة الأخطاء)
2. `api/utils/codesandbox.js` (تحسين المهلة الزمنية)
3. `.env` (إنشاء الملف إذا لم يكن موجوداً)

